<%- include("../partials/header"); -%>

<style>
  .hidden-menu {
    max-height: 0;
    overflow: hidden;
    -webkit-transition: max-height 0.5s;
    -moz-transition: max-height 0.5s;
    transition: max-height 0.5s;
  }
  .hidden-menu-show {
    max-height: 100%;
  }
</style>

<div id="users">
  <div class="text-head">
    <div class="text-title">Users</div>
    <div class="add-button">
      <button class="add-btn">
        <span class="add-icon">
          <%- include("../partials/icons/add-svg"); -%>
        </span>
        <span .add-btn-text>Add User</span>
      </button>
    </div>
  </div>

  <!-- Add user Modal -->
  <%- include("../partials/add-user-modal"); -%>

  <table class="table">
    <thead>
      <tr>
        <td class="table-img td-width-zero"></td>
        <td>Name</td>
        <td class="user-phone">Phone</td>
        <td class="user-email">Email</td>
        <td class="user-status">Status</td>
        <td class="table-action td-width-zero"></td>
      </tr>
    </thead>
    <tbody>
      <% users.map(user=>{%>
      <tr>
        <td class="table-img td-width-zero">
          <img
            src="/uploads/avatars/<%=user.avatar== null ? 'demo-avatar.png':user.avatar
              %> "
            alt=""
          />
        </td>
        <td>
          <div class="username"><%=user.user_name%></div>
          <span id="role"><%= user.user_role==='admin'? 'admin' : ''%> </span>
        </td>
        <td class="user-phone"><%=user.user_phone %></td>
        <td class="user-email"><%=user.user_mail %></td>
        <td class="user-status"><span class="status active">Active</span></td>
        <td class="user-more td-width-zero" onclick="openMenu(this)">
          <svg
            class="user-action-btn"
            width="40"
            height="40"
            viewBox="0 0 40 40"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <rect width="40" height="40" rx="15" />
            <circle cx="10" cy="20" r="2" fill="#4A4A4A" />
            <circle cx="20" cy="20" r="2" fill="#4A4A4A" />
            <circle cx="30" cy="20" r="2" fill="#4A4A4A" />
          </svg>
          <div class="hidden-menu">
            <h4>This is dropdown</h4>
          </div>
        </td>
      </tr>
      <!-- top down menu for each user-->

      <%}) %>
    </tbody>
  </table>
</div>
<!-- Pagination -->
<%- include("../partials/pagination"); -%>

<script>
  function openMenu(menu) {
    //alert("ok");
    const currentMenu = menu.childNodes[3];
    console.log(currentMenu);
    const showMenu = document.querySelector(".hidden-menu-show");

    if (!currentMenu.classList.contains("hidden-menu-show") && showMenu) {
      showMenu.classList.remove("hidden-menu-show");
    }
    currentMenu.classList.toggle("hidden-menu-show");
  }
  const userAction = document.getElementsByClassName("hidden-menu");

</script>

<script>

  // Paginations Functions

    function first(e){
      const firstPage = Number(e)
      return location.href = `/users?page=${firstPage}`
    }

    function prev(e) {
      const prevPage = Number(e - 1)
      return location.href = `/users?page=${prevPage}`
    }
    function next(e) {
      const nextPage = Number(parseInt(e) + 1)
      console.log(nextPage)
      return location.href = `/users?page=${nextPage}`
    }
    function last(e) {
      const lastPage = e
      return location.href = `/users?page=${lastPage}`
    }

</script>

<%- include("../partials/footer"); -%>
